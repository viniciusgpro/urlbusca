<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Deleter</title>
    <link rel="stylesheet" href="line_deleter.css">
</head>
<body>
    <div class="video-background">
        <video autoplay muted loop id="bgVideo">
            <source src="video/fundo1.mp4" type="video/mp4">
        </video>
    </div>
    <div class="container">
        <h1>Deletor de Linhas</h1>
        <input type="file" id="file-input" accept=".txt" multiple>
        <input type="text" id="filter-input" placeholder="Digite a URL para deletar">
        <button id="filter-button">Deletar Linhas</button>
        <div id="tabs"></div>
        <div id="results"></div>
        <div id="progress-container" class="hidden">
            <progress id="progress-bar" value="0" max="100"></progress>
            <span id="progress-text">0%</span>
        </div>
        <div id="download-all" class="hidden">
            <a id="download-all-link" class="download-link" download="filtered_lines.txt">Baixar Todas as Linhas</a>
        </div>
    </div>

    <script>
        document.getElementById('filter-button').addEventListener('click', function() {
            const fileInput = document.getElementById('file-input');
            if (!fileInput.files.length) {
                alert('Por favor, carregue pelo menos um arquivo de texto.');
                return;
            }

            const filterInput = document.getElementById('filter-input').value;
            const filters = filterInput.split(',').map(filter => filter.trim());

            const files = Array.from(fileInput.files);
            let allLines = [];
            let filesProcessed = 0;

            document.getElementById('progress-container').classList.remove('hidden');

            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const lines = event.target.result.split('\n');
                    allLines = allLines.concat(lines);
                    filesProcessed++;

                    updateProgress(filesProcessed, files.length);

                    if (filesProcessed === files.length) {
                        const filteredLines = allLines.filter(line => !filters.some(filter => line.includes(filter)));
                        paginateResults(filteredLines);
                        createDownloadAllLink(filteredLines);
                        document.getElementById('progress-container').classList.add('hidden');
                    }
                };
                reader.readAsText(file);
            });
        });

        function createDownloadAllLink(filteredLines) {
            const blob = new Blob([filteredLines.join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            const downloadAllLink = document.getElementById('download-all-link');
            downloadAllLink.href = url;
            document.getElementById('download-all').classList.remove('hidden');
        }

        function updateProgress(current, total) {
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const percentage = Math.round((current / total) * 100);

            progressBar.value = percentage;
            progressText.textContent = `${percentage}%`;
        }

        function paginateResults(lines) {
            const resultsContainer = document.getElementById('results');
            const tabsContainer = document.getElementById('tabs');
            resultsContainer.innerHTML = '';
            tabsContainer.innerHTML = '';

            const linesPerPage = 500;
            const numPages = Math.ceil(lines.length / linesPerPage);

            for (let i = 0; i < numPages; i++) {
                const tab = document.createElement('button');
                tab.textContent = i + 1;
                tab.addEventListener('click', () => showPage(i, lines, linesPerPage));
                tabsContainer.appendChild(tab);
            }

            if (numPages > 0) {
                showPage(0, lines, linesPerPage);
            }
        }

        function showPage(pageIndex, lines, linesPerPage) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';

            const start = pageIndex * linesPerPage;
            const end = Math.min(start + linesPerPage, lines.length);

            for (let i = start; i < end; i++) {
                const lineElement = document.createElement('div');
                lineElement.classList.add('line-item');

                const textElement = document.createElement('p');
                textElement.textContent = lines[i];

                lineElement.appendChild(textElement);
                resultsContainer.appendChild(lineElement);
            }
        }
    </script>
</body>
</html>
